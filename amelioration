Sub FusionnerCellulesCase()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim startRow As Long
    Dim nextNonEmptyRow As Long
    
    Application.DisplayAlerts = False
    
    ' Définir la feuille de travail cible
    Set ws = ThisWorkbook.Sheets("Transposé")
    
    ' Trouver la dernière ligne des données
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Initialiser
    i = 1
    
    ' Parcourir toutes les lignes
    While i <= lastRow
        If Not IsEmpty(ws.Cells(i, 1)) Then
            startRow = i
            
            ' Chercher la prochaine ligne non vide en colonne A
            nextNonEmptyRow = i + 1
            While nextNonEmptyRow <= lastRow And IsEmpty(ws.Cells(nextNonEmptyRow, 1))
                nextNonEmptyRow = nextNonEmptyRow + 1
            Wend
            
            ' Calculer la fin de la fusion (laisser précisément 1 ligne libre avant la prochaine cellule non vide)
            Dim endRow As Long
            If nextNonEmptyRow <= lastRow Then
                ' Si on trouve une prochaine cellule non vide, on laisse 1 ligne libre avant
                endRow = nextNonEmptyRow - 2  ' Par exemple: Si prochaine cellule est A5, endRow = A5-2 = A3
            Else
                ' Si on atteint la fin du tableau sans trouver de cellule non vide
                endRow = lastRow
            End If
            
            ' S'assurer que endRow n'est pas inférieur à startRow
            If endRow < startRow Then
                endRow = startRow
            End If
            
            ' Fusion des cellules seulement si nécessaire
            If endRow > startRow Then
                ' Debug: Afficher les valeurs pour vérification
                'MsgBox "Fusion de A" & startRow & " à A" & endRow & ", prochaine cellule: A" & nextNonEmptyRow
                
                ws.Range(ws.Cells(startRow, 1), ws.Cells(endRow, 1)).Merge
                
                ' Centrer et formater
                With ws.Cells(startRow, 1)
                    .HorizontalAlignment = xlCenter
                    .VerticalAlignment = xlCenter
                    .Orientation = 90 ' Texte vertical
                    .Font.Bold = True
                    .Interior.Color = RGB(230, 230, 230) ' Fond gris clair
                End With
            End If
            
            ' Passer à la prochaine ligne non vide pour continuer le traitement
            i = nextNonEmptyRow
        Else
            ' Si la cellule est vide, passer à la ligne suivante
            i = i + 1
        End If
    Wend
    
    Application.DisplayAlerts = True
End Sub
