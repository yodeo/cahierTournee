Sub FusionnerCellulesCase()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long, j As Long
    Dim startRow As Long
    Dim currentValue As String
    
    Application.DisplayAlerts = False
    
    ' Définir la feuille de travail cible
    Set ws = ThisWorkbook.Sheets("Transposé")
    
    ' Trouver la dernière ligne des données
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Initialiser
    i = 1
    
    ' Parcourir toutes les lignes
    While i <= lastRow
        If Not IsEmpty(ws.Cells(i, 1)) Then
            startRow = i
            currentValue = ws.Cells(i, 1).Value
            
            ' Chercher jusqu'où cette valeur se répète
            j = i + 1
            While j <= lastRow And (ws.Cells(j, 1).Value = currentValue Or IsEmpty(ws.Cells(j, 1)))
                j = j + 1
            Wend
            
            ' Décider où s'arrête la fusion
            Dim endRow As Long
            If j <= lastRow And ws.Cells(j, 1).Value <> currentValue Then
                ' Si on trouve une valeur différente, on fusionne jusqu'à 2 lignes avant
                endRow = j - 2
                If endRow < startRow Then endRow = startRow
            Else
                ' Si on atteint la fin du tableau ou si toutes les valeurs suivantes sont identiques
                endRow = j - 1
            End If
            
            ' Fusionner les cellules de la colonne A pour ce bloc
            If endRow > startRow Then
                ws.Range(ws.Cells(startRow, 1), ws.Cells(endRow, 1)).Merge
                
                ' Centrer et formater
                With ws.Cells(startRow, 1)
                    .HorizontalAlignment = xlCenter
                    .VerticalAlignment = xlCenter
                    .Orientation = 90 ' Texte vertical
                    .Font.Bold = True
                    .Interior.Color = RGB(230, 230, 230) ' Fond gris clair
                End With
            End If
            
            ' Passer à la ligne suivante après la dernière cellule traitée
            i = j
        Else
            ' Si la cellule est vide, passer à la ligne suivante
            i = i + 1
        End If
    Wend
    
    Application.DisplayAlerts = True
End Sub
