Function CalculerTaillePolice(largeur As Double, hauteur As Double, texte As String) As Double
    Dim tailleMin As Double: tailleMin = 6
    Dim tailleMax As Double: tailleMax = 18
    Dim longueur As Long
    Dim tailleParLargeur As Double
    Dim tailleParHauteur As Double
    Dim facteurLargeur As Double: facteurLargeur = 1.2
    Dim nbLignesVirtuelles As Long

    longueur = Len(texte)
    If longueur = 0 Then
        CalculerTaillePolice = tailleMin
        Exit Function
    End If

    ' Nombre de lignes dans le texte (renvois Ã  la ligne + 1)
    nbLignesVirtuelles = UBound(Split(texte, vbLf)) + 1
    If nbLignesVirtuelles < 1 Then nbLignesVirtuelles = 1

    ' Estimations
    tailleParLargeur = largeur / (longueur * facteurLargeur)
    tailleParHauteur = hauteur / (1.2 * nbLignesVirtuelles)

    CalculerTaillePolice = Application.WorksheetFunction.Min(tailleParLargeur, tailleParHauteur)

    ' Clamp et arrondi
    If CalculerTaillePolice < tailleMin Then CalculerTaillePolice = tailleMin
    If CalculerTaillePolice > tailleMax Then CalculerTaillePolice = tailleMax
    CalculerTaillePolice = Round(CalculerTaillePolice * 2) / 2
End Function
