Option Explicit

Sub AjusterTaillePolice()
    Dim ws As Worksheet
    Dim cell As Range
    Dim plageTableau As Range

    Set ws = ActiveSheet
    Set plageTableau = ws.Range("A1:AA1500")

    Application.ScreenUpdating = False

    For Each cell In plageTableau
        On Error Resume Next

        If cell.Row Mod 2 = 0 Then GoTo NextCell

        If cell.MergeCells Then
            If cell.Address = cell.MergeArea.Cells(1, 1).Address Then
                Call AjusterPoliceCellule(cell.MergeArea)
            End If
        Else
            If ACelluleAvecBordures(cell) And Not IsEmpty(cell.Value) Then
                Call AjusterPoliceCellule(cell)
            End If
        End If

NextCell:
        On Error GoTo 0
    Next cell

    Application.ScreenUpdating = True
    MsgBox "Taille de police ajustée sans modifier les hauteurs ✔️", vbInformation
End Sub

Sub AjusterPoliceCellule(c As Range)
    Dim tailleMin As Double: tailleMin = 6
    Dim tailleMax As Double: tailleMax = 18
    Dim tailleTest As Double
    Dim tailleTrouvée As Double: tailleTrouvée = tailleMin

    With c
        .WrapText = True
        .ShrinkToFit = False
        .Font.Bold = True
    End With

    For tailleTest = tailleMax To tailleMin Step -0.5
        c.Font.Size = tailleTest

        ' ❗ On ne touche pas à la hauteur de ligne ici
        If TexteVisibleComplet(c) Then
            tailleTrouvée = tailleTest
            Exit For
        End If
    Next tailleTest

    c.Font.Size = tailleTrouvée
End Sub

Function TexteVisibleComplet(cell As Range) As Boolean
    Dim visible As Boolean
    On Error Resume Next

    If cell.MergeCells Then
        visible = (Trim(cell.MergeArea.Text) = Trim(cell.MergeArea.Value))
    Else
        visible = (Trim(cell.Text) = Trim(cell.Value))
    End If

    TexteVisibleComplet = visible
    On Error GoTo 0
End Function

Function ACelluleAvecBordures(cell As Range) As Boolean
    On Error Resume Next
    ACelluleAvecBordures = (cell.Borders(xlEdgeLeft).LineStyle <> xlNone) And _
                           (cell.Borders(xlEdgeRight).LineStyle <> xlNone) And _
                           (cell.Borders(xlEdgeTop).LineStyle <> xlNone) And _
                           (cell.Borders(xlEdgeBottom).LineStyle <> xlNone)
    On Error GoTo 0
End Function

Sub AjusterTailleTableauComplet()
    Call AjusterTaillePolice
End Sub
